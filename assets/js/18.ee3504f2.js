(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{387:function(t,s,a){t.exports=a.p+"assets/img/font.9ecf4652.png"},435:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"dora-atool-build-升级到-roadhog"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dora-atool-build-升级到-roadhog"}},[t._v("#")]),t._v(" dora + atool-build 升级到 roadhog")]),t._v(" "),n("h2",{attrs:{id:"背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),n("p",[t._v("公司的一个项目做的时间比较久，用的是基于 "),n("code",[t._v("dora+atool-build")]),t._v(" 的开发和部署环境，在开发的过程中碰到了如下几个问题，一是热更新有时会不生效，导致修改文件后，需要再手动重启一下本地服务，影响了开发效率。其次是 "),n("code",[t._v("dora")]),t._v(" 和 "),n("code",[t._v("atool-build")]),t._v(" 已是比较老的版本，作者现在已停止维护，并且也给出了升级到 "),n("code",[t._v("roadhog")]),t._v(" 的建议。本文记录升级到 "),n("code",[t._v("roadhog")]),t._v(" 的步骤及遇到的问题。")]),t._v(" "),n("h2",{attrs:{id:"目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),n("p",[t._v("此次升级的主要目标如下：")]),t._v(" "),n("ol",[n("li",[t._v("将项目的开发和打包环境切换到 "),n("code",[t._v("roadhog")]),t._v("，解决当前遇到的热更新不生效的问题")]),t._v(" "),n("li",[t._v("兼容现有的打包方式，打包后的结果跟现在保持一致，包括打包后的js文件和css文件名保持现有的带hash的方式、公共文件的提取、异步加载等方式")]),t._v(" "),n("li",[t._v("兼容现有的数据mock方式，现在mock文件写的比较多，升级后仍要保持现有的mock文件有效")])]),t._v(" "),n("h2",{attrs:{id:"步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[t._v("#")]),t._v(" 步骤")]),t._v(" "),n("h3",{attrs:{id:"基本配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本配置"}},[t._v("#")]),t._v(" 基本配置")]),t._v(" "),n("p",[t._v("1、删掉package.json中的 dora 和 atool-build 相关依赖：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// dora")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dora"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.4.3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dora-plugin-proxy"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.8.2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dora-plugin-webpack"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.8.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dora-plugin-webpack-hmr"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.2.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// atool")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"atool-build"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.8.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"atool-test-mocha"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.1.5"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("2、安装 roadhog，这里使用版本是0.6.1，后面会提为什么要用这个版本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -D roadhog@0.6.1\n")])])]),n("p",[t._v("3、修改脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tscripts: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"roadhog server"')]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"roadhog-build"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"roadhog build"')]),t._v(",\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("4、新增 .roadhogrc 配置文件")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"entry"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src/index.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"disableCSSModules"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"less"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"publicPath"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"outputPath"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"autoprefixer"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"proxy"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"devtool"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eval"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extraBabelPlugins"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transform-runtime"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transform-decorators-legacy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"import"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"libraryName"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"antd"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"style"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"css"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"env"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extraBabelPlugins"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dva-hmr"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这一步可参考文档：")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/sorrycc/blog/issues/17",target:"_blank",rel:"noopener noreferrer"}},[t._v("从atool-build + dora到roadhog"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/dvajs/dva-cli/commit/203f2ffdd91a06f0b1538899e7509edc7ba2764e",target:"_blank",rel:"noopener noreferrer"}},[t._v("新增.roadhogrc"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("然后安装这几个依赖：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开发依赖")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i babel-plugin-transform-runtime@6.23.0 babel-plugin-import@1.13.3 babel-plugin-dva-hmr@0.4.0 babel-plugin-transform-decorators-legacy@1.3.5 --save-dev\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生产依赖")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i babel-runtime@6.26.0 --save\n")])])]),n("p",[t._v("插件解析：")]),t._v(" "),n("ul",[n("li",[t._v("babel-plugin-transform-runtime：编译阶段代码转换，转译语法和api。"),n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/147083132",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-plugin-transform-runtime作用"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("babel-plugin-import：antd 组件按需引入")]),t._v(" "),n("li",[t._v("babel-plugin-transform-decorators-legacy: 支持装饰器写法")]),t._v(" "),n("li",[t._v("babel-runtime：babel-plugin-transform-runtime转译过程中需要使用一些辅助函数，babel-runtime就是提供这些helper函数。运行阶段引入的对相关api(includs)或新语法(class、promise、generator等)的转换。"),n("a",{attrs:{href:"https://juejin.cn/post/6844903615212027917",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-runtime作用"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("5、新建public/index.html 文件夹，把src/index.ejs 内容复制过来，同时需要在index.html中添加如下内容：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index.js"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[t._v("这是由于.roadhog默认会打包出index.js文件，所以需要在html文件中手动引入(后面会使用webpack-html-plugin自动将打包的文件插入到html文件中，不需要手动引入)。")]),t._v(" "),n("p",[t._v("6、使用less")]),t._v(" "),n("p",[t._v("项目中使用了less变量配置了自定义主题，覆盖了antd的默认主题，所以需要在.roadhog做下需改：")]),t._v(" "),n("ol",[n("li",[t._v("把 disableCSSModules 设置为true，关闭cssModules")]),t._v(" "),n("li",[t._v("style属性设置为true，加载antd的less样式")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"disableCSSModules"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭cssModules，否则全局样式不生效")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extraBabelPlugins"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transform-runtime"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"import"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"libraryName"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"antd"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"style"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true 表示使用antd的less文件，这样自定义主题才生效")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("参考： "),n("a",{attrs:{href:"https://github.com/dvajs/dva-example-user-dashboard/commit/d6da33b3a6e18eb7f003752a4b00b5a660747c31",target:"_blank",rel:"noopener noreferrer"}},[t._v("自定义主题"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("7、修改字体引入")]),t._v(" "),n("p",[t._v("去掉 theme.less 文件中的 "),n("code",[t._v('@icon-url : "/src/static/fonts/ux/iconfont"')]),t._v(" 变量覆盖，由于升级后导致antd中的一些小字体无法显示(比如menu的箭头)")]),t._v(" "),n("p",[t._v("删除后，字体加载的是aliyun地址的字体：\n"),n("img",{attrs:{src:a(387),alt:"font"}})]),t._v(" "),n("p",[t._v("项目中使用的antd的版本是 "),n("code",[t._v("2.x.x")]),t._v("，字体需要从 "),n("code",[t._v("aliyun")]),t._v(" 上下载，但是在 "),n("code",[t._v("3.x.x")]),t._v("版本中不存在这个问题，也就是字体直接打包到了antd中")]),t._v(" "),n("p",[t._v("但是如果您觉得从aliyun上下载字体不方向，必须得从本地加载，实际上也是可以配置的：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("注释掉 theme.less 的这行代码；")])]),t._v(" "),n("li",[n("p",[t._v("是把 src/static/fonts 文件 存放到 public文件夹中")])]),t._v(" "),n("li",[n("p",[t._v("修改.roadhogrc，添加如下内容：")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"theme"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@icon-url"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"'/fonts/ux/iconfont'\"")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),n("p",[t._v("需要注意的是，双引号中一定要有单引号覆盖 "),n("code",[t._v("@icon-url")]),t._v(" 变量，参考"),n("a",{attrs:{href:"https://github.com/devisions/dvajs-user-dashboard/pull/2",target:"_blank",rel:"noopener noreferrer"}},[t._v("fix icon in package theme"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("8、安装less插件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -D less-loader@2.2.3 less@2.7.3\n")])])]),n("p",[t._v("但是呢坑总是无处不在的，如果安装less的最新的3.x.x版本，启动项目可能会遇到这个问题："),n("code",[t._v("src/index.less中 无法识别 '~antd/dist/antd.less'")])]),t._v(" "),n("p",[t._v("此时需要把less-loader版本降低，安装 less@2.7.3 这个版本")]),t._v(" "),n("p",[t._v("参考："),n("a",{attrs:{href:"https://github.com/ant-design/ant-motion/issues/44",target:"_blank",rel:"noopener noreferrer"}},[t._v('解决 dva @import "./themes/default"; 无法读取问题'),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("9、修改webapck配置文件名")]),t._v(" "),n("p",[t._v("roadhog默认会读取项目中的webpack.config.js配置文件，此时我们暂时不用到webpack配置文件，所以暂时先把配置文件改成webpack.config1.js这个名，先让项目能跑起来。")]),t._v(" "),n("p",[t._v("通过👆的配置，没有意外的话，重新启动一下项目应该能跑起来了：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run start\n")])])]),n("h3",{attrs:{id:"配置mock"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置mock"}},[t._v("#")]),t._v(" 配置mock")]),t._v(" "),n("p",[t._v("1、添加配置文件，新建.roadhogrc.mock.js 文件，并把之前的proxy.mock.js文件复制过来, 然后删除proxy.mock.js文件。在.roadhogrc.mock.js 中添加如下内容：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n * mock 写法可以使用当前这种方式\n * 也可以使用加上请求方式：\n * "POST /api/athena/monthCards/showRule/edit": "./mock/DisplayOrderConfigV2/detail.json",\n * "GET /api/athena/monthCards/showRule/edit": "./mock/DisplayOrderConfigV2/detail.json",\n */')]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./tools/mock_data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("proxyPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("2、由于新的mock方法不支持直接填写路径名称，并且需要在mock的url前添加请求方法如GET、POST，所以添加了一个兼容方法，在/tools/mock_data.js中：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" fs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("proxyPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mock "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("proxyPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" filePath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" proxyPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" filePath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      mock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" targetPath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("existsSync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("targetPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("targetPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        mock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mock文件地址"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" targetPath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"不存在，请检查"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"自定义配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义配置"}},[t._v("#")]),t._v(" 自定义配置")]),t._v(" "),n("p",[t._v("以上的过程是使用了roadhog的默认打包配置，但是在我们的项目中有一些自定义的配置，比如")]),t._v(" "),n("ul",[n("li",[t._v("打包文件名添加hash，roadhog默认打包出的文件没有hash名称")]),t._v(" "),n("li",[t._v("公共文件提取，css文件的提取")]),t._v(" "),n("li",[t._v("配置插件，自动生成html文件")])]),t._v(" "),n("p",[t._v("这些通过配置webpack.config.js文件来实现")]),t._v(" "),n("h4",{attrs:{id:"配置html-webpack-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置html-webpack-plugin"}},[t._v("#")]),t._v(" 配置html-webpack-plugin")]),t._v(" "),n("p",[t._v("1、安装")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -D html-webpack-plugin@2.29.0 html-loader@0.5.5\n")])])]),n("p",[t._v("2、在webpack.config.js中添加如下修改：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("webpackConfig")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// roadhog 默认使用 file-loader 读取html文件，读取的结果为二进制文件")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 所以需要修改为使用 html-loader 读取")]),t._v("\n\twebpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("loader")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" loader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        loader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loader "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  webpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HtmlWebpackPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意这里使用的是html文件，需要把index.ejs 改为 index.html。为什么不用ejs文件？")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用ejs文件会有相关bug")]),t._v("\n    template"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/index.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("配置这个折腾了好一阵，参考"),n("a",{attrs:{href:"https://github.com/sorrycc/roadhog/issues/231",target:"_blank",rel:"noopener noreferrer"}},[t._v("添加html打包插件"),n("OutboundLink")],1)]),t._v(" "),n("h4",{attrs:{id:"配置noparser"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置noparser"}},[t._v("#")]),t._v(" 配置noParser")]),t._v(" "),n("p",[t._v("由于系统引入了jszip.js这个库，在编译时候会有相关warnning，加上下面这行可解决：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("webpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("noParse "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("jszip.js$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("p",[t._v("参考："),n("a",{attrs:{href:"https://github.com/SheetJS/sheetjs/issues/565",target:"_blank",rel:"noopener noreferrer"}},[t._v("jszip warning in console"),n("OutboundLink")],1)]),t._v(" "),n("h4",{attrs:{id:"配置common-chunk-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置common-chunk-plugin"}},[t._v("#")]),t._v(" 配置common-chunk-plugin")]),t._v(" "),n("p",[t._v("1、安装")]),t._v(" "),n("p",[t._v("之前的webpack是从atool-build中引入的，把atool-build删除后，需要重新安装一下wepack")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -D webpack@1.14.0\n")])])]),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webpack "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webpack "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'atool-build/lib/webpack'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h4",{attrs:{id:"配置开发环境的文件名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置开发环境的文件名"}},[t._v("#")]),t._v(" 配置开发环境的文件名")]),t._v(" "),n("p",[t._v("此时，开发环境打包出的入口文件名称为index.js，在开发环境下的热更新是可以生效的，但是有个诡异的问题是，修改model中的文件，发现并没有生效，手动刷新也不行，只能重新启动一下，解决这个问题尝试了如下方法：")]),t._v(" "),n("p",[t._v("1、让 "),n("code",[t._v("roadhog")]),t._v(" 不走 "),n("code",[t._v("webpack.config.js")]),t._v(" 文件，发现修改 "),n("code",[t._v("model")]),t._v(" 文件是可以生效的，这说明这跟我们的 "),n("code",[t._v("webpack.config.js")]),t._v(" 的配置有关")]),t._v(" "),n("p",[t._v("2、猜想这可能跟 "),n("code",[t._v("model")]),t._v(" 的动态加载有关，尝试添加如下配置可生效：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("env "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  webpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filename "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[hash].js'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这样打包出的 "),n("code",[t._v("index.js")]),t._v(" 文件名就会加上hash，每次需改 "),n("code",[t._v("model")]),t._v(" 后即可生效，不过需要自己手动刷新一下。手动刷新的步骤在不使用webpack.config.js中也是需要的。")]),t._v(" "),n("h4",{attrs:{id:"生产环境提取css文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生产环境提取css文件"}},[t._v("#")]),t._v(" 生产环境提取css文件")]),t._v(" "),n("p",[t._v("提取css文件需要使用到 "),n("code",[t._v("extract-text-webpack-plugin")]),t._v(" 这个插件")]),t._v(" "),n("p",[t._v("现在打包出来的js文件都是带上了hash值的，唯有一个css文件是不带hash的，在配置文件中明明有加上提取的css文件名，但是并没有生效：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("webpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExtractTextPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[contenthash].css'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" allChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("暂时还不知添加插件的方法不生效的原因，猜测这个可能是 "),n("code",[t._v("roadhog")]),t._v(" 当前版本的一个问题。")]),t._v(" "),n("p",[t._v("既然覆盖没有效果，只能修改默认的配置了，直接修改默认的配置发现是可行的，添加如下修改：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("webpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filename "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].[contenthash].css'")]),t._v("\nwebpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" allChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("a",{attrs:{href:"https://github.com/sorrycc/roadhog/issues/69",target:"_blank",rel:"noopener noreferrer"}},[t._v("无法加上hash值的原因"),n("OutboundLink")],1)]),t._v(" "),n("h4",{attrs:{id:"修改脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改脚本"}},[t._v("#")]),t._v(" 修改脚本")]),t._v(" "),n("p",[t._v("1、此时，修改对之前的启动、打包、上传脚本做如下修改")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node bin/start.js && roadhog server"')]),t._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"roadhog-build"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"roadhog build"')]),t._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"roadhog build && npm run stark"')]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("2、修改start.js")]),t._v(" "),n("p",[t._v("这两个函数不需要了，可以注释了：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//function openBrowser() {")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//function startDora() {")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//}")]),t._v("\n")])])]),n("p",[t._v("3、修改fix_path_new")]),t._v(" "),n("p",[t._v("升级后 不存在index.css文件，这里的fix不需要了")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//var htmlFile = dist + '/index.html'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//var htmlFileContent = fs.readFileSync(htmlFile, 'utf-8')")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//fs.writeFileSync(htmlFile, (function(text) {")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//})(htmlFileContent), 'utf-8')")]),t._v("\n")])])]),n("h3",{attrs:{id:"遇到的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[t._v("#")]),t._v(" 遇到的问题")]),t._v(" "),n("p",[t._v("迁移过程中遇到的一些比较棘手的问题及解决方法：")]),t._v(" "),n("p",[t._v("1、"),n("code",[t._v("src/index.less")]),t._v(" 中无法识别 "),n("code",[t._v("'~antd/dist/antd.less'")])]),t._v(" "),n("p",[t._v("参考"),n("a",{attrs:{href:"https://github.com/ant-design/ant-motion/issues/44",target:"_blank",rel:"noopener noreferrer"}},[t._v('解决 dva @import "./themes/default"; 无法读取问题'),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("2、引入的全局样式没生效")]),t._v(" "),n("p",[n("code",[t._v("index.js")]),t._v(" 中引入的 "),n("code",[t._v("import './index.less'")]),t._v(" 没有生效")]),t._v(" "),n("p",[t._v("原因是在roadhog中默认开启了 "),n("code",[t._v("cssModule")]),t._v(" ，在 "),n("code",[t._v(".roadhogrc")]),t._v(" 中关掉即可")]),t._v(" "),n("p",[t._v("参考"),n("a",{attrs:{href:"https://blog.csdn.net/Knove/article/details/78742735?utm_medium=distribute.pc_relevant_t0.none-task-blog-searchFromBaidu-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-searchFromBaidu-1.control",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置全局less"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("3、 使用 "),n("code",[t._v("dva")]),t._v(" 高版本带来的问题")]),t._v(" "),n("ol",[n("li",[t._v("react-router不兼容问题")]),t._v(" "),n("li",[t._v("和项目中一些依赖版本不兼容，导致开发和打包时出现各种奇怪的问题")])]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("h3",{attrs:{id:"迁移结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#迁移结果"}},[t._v("#")]),t._v(" 迁移结果")]),t._v(" "),n("p",[t._v("基于以上的配置主要实现了如下几个目标：")]),t._v(" "),n("ol",[n("li",[t._v("修复了热更新不生效的问题，提升开发体验")]),t._v(" "),n("li",[t._v("不改变现有的开发方式，没有破坏性升级，保持原有的开发方式，包括数据mock等。")]),t._v(" "),n("li",[t._v("基本还原了升级前的打包效果，包括打包文件加hash、公共文件提取、异步加载等。")])]),t._v(" "),n("h3",{attrs:{id:"收获了什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#收获了什么"}},[t._v("#")]),t._v(" 收获了什么")]),t._v(" "),n("p",[t._v("之前没有在正式项目中做底层的升级，在这次升级的过程中还是遇到了一些相对棘手的问题，整体难度不大，也得到了一些收获：")]),t._v(" "),n("ol",[n("li",[t._v("整体规划。在升级之前先做充分的调研，确定要修改的内容有哪些。然后再分步骤进行，比如在此次升级过程中，先沿用了roadhog的默认配置，让项目先能跑起来。然后再修改mock、增加自定义的打包配置，最后再修改脚本。")]),t._v(" "),n("li",[t._v("一定要谷歌。过程中肯定会遇到很多奇怪的兼容问题，此时最好的办法是通过goolgle在github或stackoverflow上寻找答案")]),t._v(" "),n("li",[t._v("深入源码。在解决提取css的过程中，添加 "),n("code",[t._v("ExtractTextPlugin")]),t._v(" 并没有生效，并且尝试了很多办法没有解决，此时只能去看roadhog的源码，看下它里面是如何配置的。然后在源码中通过添加插件的方式可以解决问题，但是在配置文件中添加就无法生效。像这样的迷之bug只能在源码中才能定位问题。")]),t._v(" "),n("li",[t._v("babel及相关插件。加深了对babel相关插件的理解，比如 "),n("code",[t._v("babel-transform-runtime")]),t._v("、"),n("code",[t._v("babel-runtime")]),t._v("等的使用及区别。")]),t._v(" "),n("li",[t._v("webpack。通过修改相关配置，webpack的相关模块的配置有更多认识，比如hash、contenthash、chunkhash这些区别，webpack中的module、chunk、bundle这些概念的理解")])]),t._v(" "),n("p",[t._v("参考资料")]),t._v(" "),n("ol",[n("li",[t._v("manifest")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/95752b101582",target:"_blank",rel:"noopener noreferrer"}},[t._v("manifest"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.webpackjs.com/guides/caching/",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack-manifest"),n("OutboundLink")],1)])]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("hash")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/skychx/p/webpack-filename-chunkFilename.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("filiname"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/skychx/p/webpack-hash-chunkhash-contenthash.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("hash"),n("OutboundLink")],1)])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("插件")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.webpackjs.com/plugins/commons-chunk-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t._v("commonChunksPlugin"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);